{
    "test_case": "search_invoices_by_rut_and_amount",
    "description": "Buscar facturas por RUT y monto mínimo con información de PDFs",
    "category": "pdf_management",
    "subcategory": "info",
    "test_data": {
        "input": {
            "query": "dame las facturas del rut 96568740 con monto mayor a 500000",
            "params": {
                "expected_rut": "96568740",
                "expected_minimum_amount": 500000,
                "expected_table": "pdfs_modelo"
            }
        },
        "expected_behavior": {
            "expected_tool": "search_invoices_by_rut_and_amount",
            "expected_columns": [
                "Factura",
                "Rut",
                "Nombre",
                "Solicitante",
                "Monto_Total_Factura",
                "Copia_Tributaria_cf",
                "Copia_Cedible_cf"
            ],
            "expected_count_range": {
                "min": 1,
                "max": 50,
                "typical": 10
            }
        },
        "actual_results": {
            "validation_pending": true,
            "notes": "Test combinado: búsqueda financiera + información de PDFs disponibles. Sin parámetro pdf_type específico."
        }
    },
    "validation_criteria": {
        "criterion_1_tool_selection": {
            "description": "El agente debe seleccionar search_invoices_by_rut_and_amount",
            "validation_method": "Verificar campo 'tool_name' en response",
            "expected_value": "search_invoices_by_rut_and_amount",
            "priority": "high"
        },
        "criterion_2_rut_parsing": {
            "description": "El RUT debe parsearse correctamente",
            "validation_method": "Verificar parámetro 'rut' = '96568740'",
            "expected_value": "96568740",
            "priority": "high"
        },
        "criterion_3_amount_parsing": {
            "description": "El monto mínimo debe parsearse correctamente",
            "validation_method": "Verificar parámetro 'monto_minimo' = 500000",
            "expected_value": "500000",
            "priority": "high"
        },
        "criterion_4_rut_filtering": {
            "description": "Todas las facturas deben pertenecer al RUT solicitado",
            "validation_method": "Verificar que Rut = '96568740' en todos los resultados",
            "expected_value": "all_ruts_match",
            "priority": "high"
        },
        "criterion_5_amount_filtering": {
            "description": "Todas las facturas deben tener monto >= mínimo especificado",
            "validation_method": "Verificar que Monto_Total_Factura >= 500000 para todos los resultados",
            "expected_value": "all_amounts_above_minimum",
            "priority": "high"
        },
        "criterion_6_pdf_info_presence": {
            "description": "La respuesta debe incluir información de disponibilidad de PDFs",
            "validation_method": "Verificar presencia de columnas Copia_Tributaria_cf y/o Copia_Cedible_cf",
            "expected_value": "pdf_info_present",
            "priority": "medium"
        }
    },
    "technical_details": {
        "mcp_toolbox_logs": {
            "expected_log_entries": [
                "INFO: Ejecutando search_invoices_by_rut_and_amount",
                "INFO: Parámetros: {'rut': '96568740', 'monto_minimo': 500000}",
                "INFO: Query BigQuery ejecutada exitosamente"
            ]
        },
        "bigquery_query_pattern": "SELECT Factura, Rut, Nombre, Solicitante, Monto_Total_Factura, Copia_Tributaria_cf, Copia_Cedible_cf FROM `datalake-gasco.sap_analitico_facturas_pdf_qa.pdfs_modelo` WHERE Rut = '96568740' AND Monto_Total_Factura >= 500000 ORDER BY Monto_Total_Factura DESC LIMIT 50",
        "timeout_seconds": 600,
        "retry_strategy": "none"
    },
    "business_impact": {
        "user_facing": true,
        "criticality": "high",
        "use_cases": [
            "Búsqueda de facturas de alto valor de un cliente",
            "Análisis financiero con disponibilidad de documentos",
            "Priorización de cobros con acceso rápido a PDFs"
        ],
        "priority_level": "P1"
    }
}