{
  "test_id": "E1",
  "test_name": "year_2024_rut_solicitante",
  "description": "Test exhaustivo: Validar búsqueda por RUT + Solicitante + Año 2024 (año anterior)",
  "priority": "HIGH",
  "category": "temporal_coverage",
  "tool_tested": "search_invoices_by_rut_solicitante_and_year",
  "query": "Dame las facturas del RUT 76262399-4, solicitante 12527236, del año 2024",
  "parameters": {
    "target_rut": "76262399-4",
    "solicitante_code": "12527236",
    "target_year": 2024,
    "pdf_type": "both"
  },
  "expected_results": {
    "tool_selected": "search_invoices_by_rut_solicitante_and_year",
    "min_invoices": 0,
    "max_invoices": 200,
    "pdf_types": [
      "Copia_Tributaria_cf",
      "Copia_Cedible_cf"
    ],
    "pdf_multiplier": 2,
    "notes": "El año 2024 puede o no tener datos para esta combinación RUT+Solicitante"
  },
  "validation_criteria": [
    {
      "id": "VC1",
      "name": "tool_selection",
      "description": "Agente debe seleccionar search_invoices_by_rut_solicitante_and_year",
      "critical": true
    },
    {
      "id": "VC2",
      "name": "parameter_extraction",
      "description": "Parámetros extraídos correctamente: RUT, Solicitante, Año 2024",
      "critical": true
    },
    {
      "id": "VC3",
      "name": "lpad_normalization",
      "description": "Solicitante normalizado: 12527236 → 0012527236",
      "critical": true
    },
    {
      "id": "VC4",
      "name": "year_filtering",
      "description": "Filtrado EXTRACT(YEAR FROM fecha) = 2024",
      "critical": true
    },
    {
      "id": "VC5",
      "name": "sql_execution",
      "description": "Query BigQuery ejecutada sin errores",
      "critical": true
    },
    {
      "id": "VC6",
      "name": "response_coherence",
      "description": "Respuesta del agente coherente con resultados",
      "critical": false
    }
  ],
  "test_execution": {
    "endpoint": "http://localhost:8001/chat",
    "method": "POST",
    "timeout": 600
  },
  "status": "FAILED",
  "executed_at": "2025-10-10 10:20:41",
  "results": {
    "response_preview": "",
    "invoices_found": 0,
    "tool_used": [
      "search_invoices_by_rut_solicitante_and_year"
    ],
    "zip_created": false,
    "execution_time": "135.85s",
    "pdfs_generated": 0,
    "validations": {
      "sql_execution": true,
      "response_received": false,
      "tool_selection": true
    }
  },
  "notes": "Este test valida que las herramientas funcionan con años históricos diferentes a 2025. Si hay 0 resultados, es aceptable siempre que no haya errores de ejecución."
}
