{
    "test_id": "E2",
    "test_name": "year_2024_rut_only",
    "description": "Test exhaustivo: Validar b√∫squeda por RUT + A√±o 2024 (sin filtrar por solicitante)",
    "priority": "HIGH",
    "category": "temporal_coverage",
    "tool_tested": "search_invoices_by_rut_and_year",
    "query": "Dame todas las facturas del RUT 76262399-4 del a√±o 2024",
    "parameters": {
        "target_rut": "76262399-4",
        "target_year": 2024,
        "pdf_type": "both"
    },
    "expected_results": {
        "tool_selected": "search_invoices_by_rut_and_year",
        "min_invoices": 0,
        "max_invoices": 200,
        "pdf_types": [
            "Copia_Tributaria_cf",
            "Copia_Cedible_cf"
        ],
        "pdf_multiplier": 2,
        "notes": "Debe incluir todas las facturas del RUT independiente del solicitante"
    },
    "validation_criteria": [
        {
            "id": "VC1",
            "name": "tool_selection",
            "description": "Agente debe seleccionar search_invoices_by_rut_and_year",
            "critical": true
        },
        {
            "id": "VC2",
            "name": "parameter_extraction",
            "description": "Par√°metros extra√≠dos correctamente: RUT, A√±o 2024",
            "critical": true
        },
        {
            "id": "VC3",
            "name": "year_filtering",
            "description": "Filtrado EXTRACT(YEAR FROM fecha) = 2024",
            "critical": true
        },
        {
            "id": "VC4",
            "name": "no_solicitante_filter",
            "description": "No debe filtrar por solicitante espec√≠fico",
            "critical": true
        },
        {
            "id": "VC5",
            "name": "sql_execution",
            "description": "Query BigQuery ejecutada sin errores",
            "critical": true
        },
        {
            "id": "VC6",
            "name": "response_coherence",
            "description": "Respuesta incluye todas las facturas del RUT en 2024",
            "critical": false
        }
    ],
    "test_execution": {
        "endpoint": "http://localhost:8001/chat",
        "method": "POST",
        "timeout": 300
    },
    "status": "PASSED",
    "executed_at": "2025-10-09 18:37:42",
    "results": {
        "zip_created": true,
        "pdfs_generated": 120,
        "execution_time": "268.02s",
        "response_preview": "üìä 60 facturas encontradas (per√≠odo: 2024-01-04 - 2024-12-18)\n\nüìã Listado de facturas:\n‚Ä¢ Factura 0104978167 - ALIMENTOS RUNCA VALDIVIA LIMITADA (RUT: 76262399-4) - Fecha: 2024-12-18\n‚Ä¢ Factura 0104978166 - ALIMENTOS RUNCA VALDIVIA LIMITADA (RUT: 76262399-4) - Fecha: 2024-12-18\n‚Ä¢ Factura 0104978165 - ALIMENTOS RUNCA VALDIVIA LIMITADA (RUT: 76262399-4) - Fecha: 2024-12-18\n‚Ä¢ Factura 0104978163 - ALIMENTOS RUNCA VALDIVIA LIMITADA (RUT: 76262399-4) - Fecha: 2024-12-18\n‚Ä¢ Factura 0104978161 - ALIMENTOS ",
        "tool_used": [
            "search_invoices_by_rut_and_year",
            "create_standard_zip"
        ],
        "validations": {
            "tool_selection": true,
            "response_received": true,
            "sql_execution": true
        },
        "invoices_found": 60
    },
    "notes": "Este test valida que la herramienta busca en TODO el a√±o 2024 sin filtrar por solicitante. Si el RUT tiene m√∫ltiples solicitantes, debe incluirlos todos."
}