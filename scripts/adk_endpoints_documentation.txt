========================================
ADK API SERVER ENDPOINTS DOCUMENTATION
========================================
Generado: 2025-09-01 11:40:48
Servidor: http://localhost:8001
Agente: gcp-invoice-agent-app
Script: document_adk_endpoints.ps1
Sistema: Windows PowerShell

========================================
GET http://localhost:8001/openapi.json
Status: SUCCESS
Response: Schema disponible con 23 endpoints

========================================
2. LISTA DE APLICACIONES/AGENTES
========================================
GET http://localhost:8001/list-apps
Status: SUCCESS
Response: "gcp-invoice-agent-app"

Agentes disponibles: gcp-invoice-agent-app
========================================
3. DOCUMENTACI√ìN OPENAPI
========================================
GET http://localhost:8001/openapi.json
Status: SUCCESS
T√≠tulo: FastAPI
Versi√≥n: 0.1.0

Endpoints detectados autom√°ticamente:
- /list-apps
  GET: List Apps
- /debug/trace/{event_id}
  GET: Get Trace Dict
- /debug/trace/session/{session_id}
  GET: Get Session Trace
- /apps/{app_name}/users/{user_id}/sessions/{session_id}
  GET: Get Session
  POST: Create Session With Id
  DELETE: Delete Session
- /apps/{app_name}/users/{user_id}/sessions
  GET: List Sessions
  POST: Create Session
- /apps/{app_name}/eval_sets/{eval_set_id}
  POST: Create Eval Set
- /apps/{app_name}/eval_sets
  GET: List Eval Sets
- /apps/{app_name}/eval_sets/{eval_set_id}/add_session
  POST: Add Session To Eval Set
- /apps/{app_name}/eval_sets/{eval_set_id}/evals
  GET: List Evals In Eval Set
- /apps/{app_name}/eval_sets/{eval_set_id}/evals/{eval_case_id}
  GET: Get Eval
  PUT: Update Eval
  DELETE: Delete Eval
- /apps/{app_name}/eval_sets/{eval_set_id}/run_eval
  POST: Run Eval
- /apps/{app_name}/eval_results/{eval_result_id}
  GET: Get Eval Result
- /apps/{app_name}/eval_results
  GET: List Eval Results
- /apps/{app_name}/eval_metrics
  GET: List Eval Metrics
- /apps/{app_name}/users/{user_id}/sessions/{session_id}/artifacts/{artifact_name}
  GET: Load Artifact
  DELETE: Delete Artifact
- /apps/{app_name}/users/{user_id}/sessions/{session_id}/artifacts/{artifact_name}/versions/{version_id}
  GET: Load Artifact Version
- /apps/{app_name}/users/{user_id}/sessions/{session_id}/artifacts
  GET: List Artifact Names
- /apps/{app_name}/users/{user_id}/sessions/{session_id}/artifacts/{artifact_name}/versions
  GET: List Artifact Versions
- /run
  POST: Run Agent
- /run_sse
  POST: Run Agent Sse
- /apps/{app_name}/users/{user_id}/sessions/{session_id}/events/{event_id}/graph
  GET: Get Event Graph
- /builder/save
  POST: Builder Build
- /builder/app/{app_name}
  GET: Get Agent Builder
========================================
4. ENDPOINTS PRINCIPALES DOCUMENTADOS
========================================

üîπ ENDPOINT PRINCIPAL PARA CONSULTAS (seg√∫n documentaci√≥n oficial ADK)
POST http://localhost:8001/run
Descripci√≥n: Endpoint unificado para consultas a agentes
Content-Type: application/json

‚ö†Ô∏è  IMPORTANTE: El request usa camelCase, NO snake_case como indicaba la documentaci√≥n inicial.

Request format (camelCase):
{
  "appName": "gcp-invoice-agent-app",
  "userId": "test-user", 
  "sessionId": "session-id",
  "newMessage": {
    "parts": [{"text": "tu consulta sobre facturas aqu√≠"}],
    "role": "user"
  },
  "streaming": false
}

Response format:
Array de eventos (Event-Output[]) con la conversaci√≥n completa

üîπ ENDPOINT CON SERVER-SENT EVENTS
POST http://localhost:8001/run_sse
Descripci√≥n: Mismo request que /run pero con streaming en tiempo real

üîπ DOCUMENTACI√ìN DE API
GET http://localhost:8001/docs
Descripci√≥n: Interfaz Swagger UI para explorar la API

GET http://localhost:8001/openapi.json
Descripci√≥n: Esquema OpenAPI completo de la API========================================
5. AGENTE ESPECIALIZADO: gcp-invoice-agent-app
========================================

üéØ ESPECIALIZACI√ìN:
- Facturas chilenas del sector energ√©tico
- 300+ PDFs disponibles en Google Cloud Storage
- B√∫squedas inteligentes por fecha, emisor, receptor, RUT
- Generaci√≥n autom√°tica de ZIPs para descargas masivas
- Enlaces de descarga proxy para PDFs individuales

üõ†Ô∏è HERRAMIENTAS MCP DISPONIBLES (32 herramientas):
- search_invoices: B√∫squeda general de facturas
- search_invoices_by_date_range: Filtro por rango de fechas
- search_invoices_by_emisor: Filtro por empresa emisora
- search_invoices_by_referencia_number: B√∫squeda por n√∫mero de referencia
- get_all_invoices_with_pdf_info: Informaci√≥n completa con rutas PDF
- create_pending_zip: Gesti√≥n de descargas masivas
- get_invoices_with_proxy_links: URLs de descarga autom√°tica

üîç EJEMPLOS DE CONSULTAS T√çPICAS:
- "¬øCu√°ntas facturas tienes disponibles?"
- "Facturas de abril 2003"
- "Facturas del emisor AGROSUPER"
- "Dame los datos de la factura referencia 8506601"
- "Facturas del RUT 9025012-4"========================================
6. EJEMPLO COMPLETO DE USO
========================================# Ejemplo completo usando endpoint oficial /run con formato correcto
$sessionId = "doc-session-283471224"

# Enviar consulta con formato camelCase seg√∫n OpenAPI schema real
$queryBody = @{
    appName = "gcp-invoice-agent-app"
    userId = "doc-user"
    sessionId = $sessionId
    newMessage = @{
        parts = @(@{text = "¬øCu√°ntas facturas tienes disponibles?"})
        role = "user"
    }
    streaming = $false
} | ConvertTo-Json -Depth 5

Write-Host "üîç Enviando consulta al agente..."
$response = Invoke-RestMethod -Uri "http://localhost:8001/run" -Method POST -ContentType "application/json" -Body $queryBody

# Extraer respuesta del agente
$lastEvent = $response | Where-Object { $_.content.role -eq "model" } | Select-Object -Last 1
$answer = $lastEvent.content.parts[0].text

Write-Host "ü§ñ Respuesta del agente:"
Write-Host $answer========================================
7. INFORMACI√ìN ADICIONAL
========================================

üìö DOCUMENTACI√ìN RELACIONADA:
- DOCUMENTACION_FUNCIONAMIENTO.md: Documentaci√≥n t√©cnica completa
- my-agents/gcp-invoice-agent-app/README.md: Configuraci√≥n espec√≠fica del agente
- mcp-toolbox/tools_updated.yaml: Definici√≥n completa de herramientas

üåê URLS IMPORTANTES:
- API Principal: http://localhost:8001
- Swagger UI: http://localhost:8001/docs
- ReDoc: http://localhost:8001/redoc
- OpenAPI Schema: http://localhost:8001/openapi.json

üìû SOPORTE:
- Verificar que todos los servicios est√©n corriendo
- Revisar archivos .env para configuraci√≥n correcta
- Validar conectividad a Google Cloud (BigQuery y Storage)

========================================
FIN DEL DOCUMENTO
========================================
Generado autom√°ticamente por: document_adk_endpoints.ps1
Fecha: 2025-09-01 11:40:53
Servidor documentado: http://localhost:8001
Estado de tests: NO EJECUTADOS
Total de l√≠neas: 169
========================================
